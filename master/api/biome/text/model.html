<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>biome.text.model | biome.text</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" href="/biome-text/master/favicon.ico">
    <meta name="description" content="biome.text practical NLP open source library.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="https://www.recogn.ai/images/biome_og.png">
    
    <link rel="preload" href="/biome-text/master/assets/css/0.styles.26498fa5.css" as="style"><link rel="preload" href="/biome-text/master/assets/js/app.7e5ef899.js" as="script"><link rel="preload" href="/biome-text/master/assets/js/4.8c7282f9.js" as="script"><link rel="preload" href="/biome-text/master/assets/js/3.c1cfb773.js" as="script"><link rel="preload" href="/biome-text/master/assets/js/34.3abafb22.js" as="script"><link rel="preload" href="/biome-text/master/assets/js/6.4b76f008.js" as="script"><link rel="prefetch" href="/biome-text/master/assets/js/10.324582b8.js"><link rel="prefetch" href="/biome-text/master/assets/js/11.57a9d37d.js"><link rel="prefetch" href="/biome-text/master/assets/js/12.3884da43.js"><link rel="prefetch" href="/biome-text/master/assets/js/13.b4f4abc2.js"><link rel="prefetch" href="/biome-text/master/assets/js/14.9a88c2db.js"><link rel="prefetch" href="/biome-text/master/assets/js/15.28967300.js"><link rel="prefetch" href="/biome-text/master/assets/js/16.d5eb5412.js"><link rel="prefetch" href="/biome-text/master/assets/js/17.dc87945c.js"><link rel="prefetch" href="/biome-text/master/assets/js/18.e9a8c3c2.js"><link rel="prefetch" href="/biome-text/master/assets/js/19.4f9d38be.js"><link rel="prefetch" href="/biome-text/master/assets/js/20.2acd7bc5.js"><link rel="prefetch" href="/biome-text/master/assets/js/21.f0108584.js"><link rel="prefetch" href="/biome-text/master/assets/js/22.73902552.js"><link rel="prefetch" href="/biome-text/master/assets/js/23.e0234264.js"><link rel="prefetch" href="/biome-text/master/assets/js/24.b96a7ddd.js"><link rel="prefetch" href="/biome-text/master/assets/js/25.d1cbe125.js"><link rel="prefetch" href="/biome-text/master/assets/js/26.4f5ecab6.js"><link rel="prefetch" href="/biome-text/master/assets/js/27.e356ded2.js"><link rel="prefetch" href="/biome-text/master/assets/js/28.485bc4e7.js"><link rel="prefetch" href="/biome-text/master/assets/js/29.2af114e2.js"><link rel="prefetch" href="/biome-text/master/assets/js/30.6a0c932a.js"><link rel="prefetch" href="/biome-text/master/assets/js/31.d57e86cd.js"><link rel="prefetch" href="/biome-text/master/assets/js/32.c2c03dbe.js"><link rel="prefetch" href="/biome-text/master/assets/js/33.f5c1d9f0.js"><link rel="prefetch" href="/biome-text/master/assets/js/35.385f9a6a.js"><link rel="prefetch" href="/biome-text/master/assets/js/36.1b225f4e.js"><link rel="prefetch" href="/biome-text/master/assets/js/37.a959dc0c.js"><link rel="prefetch" href="/biome-text/master/assets/js/38.993aff5c.js"><link rel="prefetch" href="/biome-text/master/assets/js/39.81fc7c5c.js"><link rel="prefetch" href="/biome-text/master/assets/js/40.d88c670a.js"><link rel="prefetch" href="/biome-text/master/assets/js/41.cfa51658.js"><link rel="prefetch" href="/biome-text/master/assets/js/42.966e96b3.js"><link rel="prefetch" href="/biome-text/master/assets/js/43.fe0149fb.js"><link rel="prefetch" href="/biome-text/master/assets/js/44.71ac474d.js"><link rel="prefetch" href="/biome-text/master/assets/js/45.d8f442de.js"><link rel="prefetch" href="/biome-text/master/assets/js/46.ec7eda28.js"><link rel="prefetch" href="/biome-text/master/assets/js/47.f19730b4.js"><link rel="prefetch" href="/biome-text/master/assets/js/48.d9ac7bea.js"><link rel="prefetch" href="/biome-text/master/assets/js/49.7fdb0e8e.js"><link rel="prefetch" href="/biome-text/master/assets/js/5.73ece6cb.js"><link rel="prefetch" href="/biome-text/master/assets/js/50.de6ee286.js"><link rel="prefetch" href="/biome-text/master/assets/js/51.581cdc52.js"><link rel="prefetch" href="/biome-text/master/assets/js/52.7c287157.js"><link rel="prefetch" href="/biome-text/master/assets/js/53.6027f680.js"><link rel="prefetch" href="/biome-text/master/assets/js/54.77f4ccbe.js"><link rel="prefetch" href="/biome-text/master/assets/js/55.761b0603.js"><link rel="prefetch" href="/biome-text/master/assets/js/56.8ba0bc7d.js"><link rel="prefetch" href="/biome-text/master/assets/js/57.9f8e761f.js"><link rel="prefetch" href="/biome-text/master/assets/js/58.cd6e80c0.js"><link rel="prefetch" href="/biome-text/master/assets/js/59.1b5c164a.js"><link rel="prefetch" href="/biome-text/master/assets/js/60.ccde12e8.js"><link rel="prefetch" href="/biome-text/master/assets/js/61.5733ddbb.js"><link rel="prefetch" href="/biome-text/master/assets/js/62.8d1dd145.js"><link rel="prefetch" href="/biome-text/master/assets/js/63.a97520be.js"><link rel="prefetch" href="/biome-text/master/assets/js/64.91ffc21c.js"><link rel="prefetch" href="/biome-text/master/assets/js/65.c4a00c0b.js"><link rel="prefetch" href="/biome-text/master/assets/js/66.2ee948d4.js"><link rel="prefetch" href="/biome-text/master/assets/js/67.63d18121.js"><link rel="prefetch" href="/biome-text/master/assets/js/68.1c09a5f5.js"><link rel="prefetch" href="/biome-text/master/assets/js/69.f7318f0e.js"><link rel="prefetch" href="/biome-text/master/assets/js/7.5737c154.js"><link rel="prefetch" href="/biome-text/master/assets/js/70.c5eec0af.js"><link rel="prefetch" href="/biome-text/master/assets/js/71.4587089a.js"><link rel="prefetch" href="/biome-text/master/assets/js/8.6718f9cd.js"><link rel="prefetch" href="/biome-text/master/assets/js/9.58d92766.js"><link rel="prefetch" href="/biome-text/master/assets/js/vendors~docsearch.b3708bf9.js">
    <link rel="stylesheet" href="/biome-text/master/assets/css/0.styles.26498fa5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-348088ed><header class="navbar" data-v-348088ed><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/biome-text/master/" class="home-link router-link-active"><!----> <span class="site-name">biome<span>.text</span></span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/biome-text/master/api/" class="nav-link router-link-active">
  API
</a></div><div class="nav-item"><a href="/biome-text/master/documentation/" class="nav-link">
  Documentation
</a></div><div class="nav-item"><a href="https://github.com/recognai/biome-text" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span class="external__icon"><vp-icon color="#4A4A4A" name="blank" size="12px"></vp-icon></span></a></div><div class="nav-item"><a href="https://recogn.ai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Recognai
  <span class="external__icon"><vp-icon color="#4A4A4A" name="blank" size="12px"></vp-icon></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-348088ed></div> <aside class="sidebar" data-v-348088ed><div class="sidebar__link"><a href="/biome-text/master/"><img src="/biome-text/master/assets/img/biome.svg" class="sidebar__img"></a></div> <!----> <nav class="nav-links"><div class="nav-item"><a href="/biome-text/master/api/" class="nav-link router-link-active">
  API
</a></div><div class="nav-item"><a href="/biome-text/master/documentation/" class="nav-link">
  Documentation
</a></div><div class="nav-item"><a href="https://github.com/recognai/biome-text" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span class="external__icon"><vp-icon color="#4A4A4A" name="blank" size="12px"></vp-icon></span></a></div><div class="nav-item"><a href="https://recogn.ai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Recognai
  <span class="external__icon"><vp-icon color="#4A4A4A" name="blank" size="12px"></vp-icon></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/biome-text/master/api/biome/text/backbone.html" class="sidebar-link">biome.text.backbone</a></li><li><a href="/biome-text/master/api/biome/text/cli/cli.html" class="sidebar-link">biome.text.cli.cli</a></li><li><a href="/biome-text/master/api/biome/text/cli/evaluate.html" class="sidebar-link">biome.text.cli.evaluate</a></li><li><a href="/biome-text/master/api/biome/text/cli/serve.html" class="sidebar-link">biome.text.cli.serve</a></li><li><a href="/biome-text/master/api/biome/text/cli/train.html" class="sidebar-link">biome.text.cli.train</a></li><li><a href="/biome-text/master/api/biome/text/commons.html" class="sidebar-link">biome.text.commons</a></li><li><a href="/biome-text/master/api/biome/text/configuration.html" class="sidebar-link">biome.text.configuration</a></li><li><a href="/biome-text/master/api/biome/text/constants.html" class="sidebar-link">biome.text.constants</a></li><li><a href="/biome-text/master/api/biome/text/dataset.html" class="sidebar-link">biome.text.dataset</a></li><li><a href="/biome-text/master/api/biome/text/environment.html" class="sidebar-link">biome.text.environment</a></li><li><a href="/biome-text/master/api/biome/text/errors.html" class="sidebar-link">biome.text.errors</a></li><li><a href="/biome-text/master/api/biome/text/explore.html" class="sidebar-link">biome.text.explore</a></li><li><a href="/biome-text/master/api/biome/text/features.html" class="sidebar-link">biome.text.features</a></li><li><a href="/biome-text/master/api/biome/text/featurizer.html" class="sidebar-link">biome.text.featurizer</a></li><li><a href="/biome-text/master/api/biome/text/helpers.html" class="sidebar-link">biome.text.helpers</a></li><li><a href="/biome-text/master/api/biome/text/hpo.html" class="sidebar-link">biome.text.hpo</a></li><li><a href="/biome-text/master/api/biome/text/loggers.html" class="sidebar-link">biome.text.loggers</a></li><li><a href="/biome-text/master/api/biome/text/metrics.html" class="sidebar-link">biome.text.metrics</a></li><li><a href="/biome-text/master/api/biome/text/mlflow_model.html" class="sidebar-link">biome.text.mlflow_model</a></li><li><a href="/biome-text/master/api/biome/text/model.html" aria-current="page" class="active sidebar-link">biome.text.model</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/biome-text/master/api/biome/text/model.html#pipelinemodel" class="sidebar-link">PipelineModel</a></li></ul></li><li><a href="/biome-text/master/api/biome/text/modules/configuration/allennlp_configuration.html" class="sidebar-link">biome.text.modules.configuration.allennlp_configuration</a></li><li><a href="/biome-text/master/api/biome/text/modules/configuration/defs.html" class="sidebar-link">biome.text.modules.configuration.defs</a></li><li><a href="/biome-text/master/api/biome/text/modules/encoders/time_distributed_encoder.html" class="sidebar-link">biome.text.modules.encoders.timedistributedencoder</a></li><li><a href="/biome-text/master/api/biome/text/modules/heads/classification/classification.html" class="sidebar-link">biome.text.modules.heads.classification.classification</a></li><li><a href="/biome-text/master/api/biome/text/modules/heads/classification/doc_classification.html" class="sidebar-link">biome.text.modules.heads.classification.doc_classification</a></li><li><a href="/biome-text/master/api/biome/text/modules/heads/classification/record_classification.html" class="sidebar-link">biome.text.modules.heads.classification.record_classification</a></li><li><a href="/biome-text/master/api/biome/text/modules/heads/classification/record_pair_classification.html" class="sidebar-link">biome.text.modules.heads.classification.recordpairclassification</a></li><li><a href="/biome-text/master/api/biome/text/modules/heads/classification/relation_classification.html" class="sidebar-link">biome.text.modules.heads.classification.relation_classification</a></li><li><a href="/biome-text/master/api/biome/text/modules/heads/classification/text_classification.html" class="sidebar-link">biome.text.modules.heads.classification.text_classification</a></li><li><a href="/biome-text/master/api/biome/text/modules/heads/language_modelling.html" class="sidebar-link">biome.text.modules.heads.language_modelling</a></li><li><a href="/biome-text/master/api/biome/text/modules/heads/task_head.html" class="sidebar-link">biome.text.modules.heads.task_head</a></li><li><a href="/biome-text/master/api/biome/text/modules/heads/task_prediction.html" class="sidebar-link">biome.text.modules.heads.task_prediction</a></li><li><a href="/biome-text/master/api/biome/text/modules/heads/token_classification.html" class="sidebar-link">biome.text.modules.heads.token_classification</a></li><li><a href="/biome-text/master/api/biome/text/pipeline.html" class="sidebar-link">biome.text.pipeline</a></li><li><a href="/biome-text/master/api/biome/text/text_cleaning.html" class="sidebar-link">biome.text.text_cleaning</a></li><li><a href="/biome-text/master/api/biome/text/tokenizer.html" class="sidebar-link">biome.text.tokenizer</a></li><li><a href="/biome-text/master/api/biome/text/trainer.html" class="sidebar-link">biome.text.trainer</a></li><li><a href="/biome-text/master/api/biome/text/training_results.html" class="sidebar-link">biome.text.training_results</a></li><li><a href="/biome-text/master/api/biome/text/ui/app.html" class="sidebar-link">biome.text.ui.app</a></li><li><a href="/biome-text/master/api/biome/text/ui/ui.html" class="sidebar-link">biome.text.ui.ui</a></li><li><a href="/biome-text/master/api/biome/text/vocabulary.html" class="sidebar-link">biome.text.vocabulary</a></li></ul></section></li></ul> </aside> <main class="page" data-v-348088ed> <div class="theme-default-content content__default"><h1 id="biome-text-model"><a href="#biome-text-model" class="header-anchor">#</a> biome.text.model <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Module</span></h1> <div></div> <div></div> <pre class="title"><h2 id="pipelinemodel"><a href="#pipelinemodel" class="header-anchor">#</a> PipelineModel <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Class</span></h2>
</pre> <pre class="language-python"><code>
<span class="token keyword">class</span> <span class="ident">PipelineModel</span> (name: str, head: <a title="biome.text.modules.heads.task_head.TaskHead" href="modules/heads/task_head.html#biome.text.modules.heads.task_head.TaskHead">TaskHead</a>)
</code>
</pre> <p>This class represents pipeline model implementation for connect biome.text concepts with
allennlp implementation details</p> <p>This class manages the head + backbone encoder, keeping the allennlnlp Model lifecycle. This class
should be hidden to api users.</p> <h2 id="parameters">Parameters</h2> <dl><dt><strong><code>name</code></strong></dt> <dd>Name of the pipeline model</dd> <dt><strong><code>head</code></strong></dt> <dd>TaskHead of the pipeline model</dd></dl> <h2 id="attributes">Attributes</h2> <dl><dt><strong><code>name</code></strong> : <code>str</code></dt> <dd>Name of the pipeline model</dd> <dt><strong><code>head</code></strong> : <code>TaskHead</code></dt> <dd>TaskHead of the pipeline model</dd> <dt><strong><code>vocab</code></strong> : <code>Vocabulary</code></dt> <dd>The vocabulary of the model, comes from allennlp.models.Model</dd> <dt><strong><code>file_path</code></strong> : <code>Optional[str]</code></dt> <dd>File path to a serialized version of this pipeline model</dd> <dt><strong><code>inputs</code></strong> : <code>List[str]</code></dt> <dd>The model inputs</dd> <dt><strong><code>output</code></strong> : <code>List[str]</code></dt> <dd>The model outputs (not prediction): Corresponding to the <code>TaskHead.featurize</code> optional arguments.</dd></dl> <pre class="title"><h3 id="ancestors"><a href="#ancestors" class="header-anchor">#</a> Ancestors</h3>
</pre> <ul class="hlist"><li>allennlp.models.model.Model</li> <li>pytorch_lightning.core.lightning.LightningModule</li> <li>abc.ABC</li> <li>pytorch_lightning.utilities.device_dtype_mixin.DeviceDtypeModuleMixin</li> <li>pytorch_lightning.core.grads.GradInformation</li> <li>pytorch_lightning.core.saving.ModelIO</li> <li>pytorch_lightning.core.hooks.ModelHooks</li> <li>pytorch_lightning.core.hooks.DataHooks</li> <li>pytorch_lightning.core.hooks.CheckpointHooks</li> <li>torch.nn.modules.module.Module</li> <li>allennlp.common.registrable.Registrable</li> <li>allennlp.common.from_params.FromParams</li></ul> <dl><pre class="title"><h3 id="from-params"><a href="#from-params" class="header-anchor">#</a> from_params <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Static method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">from_params</span> (
  params: allennlp.common.params.Params,
  vocab: Union[allennlp.data.vocabulary.Vocabulary, NoneType] = None,
  **extras,
)  -&gt; <a title="biome.text.model.PipelineModel" href="#biome.text.model.PipelineModel">PipelineModel</a>
</code>
</pre></div></dt> <dd><p>Load the model implementation from params. We build manually each component from config sections.</p> <p>The param keys matches exactly with keys in yaml configuration files</p> <h2 id="parameters">Parameters</h2> <dl><dt><strong><code>params</code></strong></dt> <dd>The config key in these params is used to build the model components</dd> <dt><strong><code>vocab</code></strong></dt> <dd>The vocabulary for the model</dd> <dt><strong><code>**extras</code></strong></dt> <dd>Necessary for AllenNLP from_params machinery</dd></dl> <h2 id="returns">Returns</h2> <dl><dt><code>pipeline_model</code></dt> <dd> </dd></dl></dd></dl> <pre class="title"><h3 id="instance-variables"><a href="#instance-variables" class="header-anchor">#</a> Instance variables</h3>
</pre> <dl><dt id="biome.text.model.PipelineModel.head"><code class="name">var <span class="ident">head</span> : <a title="biome.text.modules.heads.task_head.TaskHead" href="modules/heads/task_head.html#biome.text.modules.heads.task_head.TaskHead">TaskHead</a></code></dt> <dd><p>Get the model head</p></dd> <dt id="biome.text.model.PipelineModel.inputs"><code class="name">var <span class="ident">inputs</span> : List[str]</code></dt> <dd><p>The model inputs. Corresponding to head.featurize required argument names</p></dd> <dt id="biome.text.model.PipelineModel.output"><code class="name">var <span class="ident">output</span> : List[str]</code></dt> <dd><p>The model outputs (not prediction): Corresponding to head.featurize optional argument names.</p></dd></dl> <dl><pre class="title"><h3 id="set-head"><a href="#set-head" class="header-anchor">#</a> set_head <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">set_head</span> (
  self,
  head: <a title="biome.text.modules.heads.task_head.TaskHead" href="modules/heads/task_head.html#biome.text.modules.heads.task_head.TaskHead">TaskHead</a>,
)  -&gt; NoneType
</code>
</pre></div></dt> <dd><p>Set a head and update related model attributes</p></dd> <pre class="title"><h3 id="forward"><a href="#forward" class="header-anchor">#</a> forward <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">forward</span> (
  self,
  *args,
  **kwargs,
)  -&gt; Dict[str, torch.Tensor]
</code>
</pre></div></dt> <dd><p>The main forward method just wraps the head forward method</p></dd> <pre class="title"><h3 id="get-metrics"><a href="#get-metrics" class="header-anchor">#</a> get_metrics <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">get_metrics</span> (
  self,
  reset: bool = False,
)  -&gt; Dict[str, float]
</code>
</pre></div></dt> <dd><p>Fetch metrics defined in head layer</p></dd> <pre class="title"><h3 id="text-to-instance"><a href="#text-to-instance" class="header-anchor">#</a> text_to_instance <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">text_to_instance</span> (
  self,
  **inputs,
)  -&gt; Union[allennlp.data.instance.Instance, NoneType]
</code>
</pre></div></dt> <dd><p>Applies the head featurize method</p></dd> <pre class="title"><h3 id="extend-vocabulary"><a href="#extend-vocabulary" class="header-anchor">#</a> extend_vocabulary <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">extend_vocabulary</span> (
  self,
  vocab: allennlp.data.vocabulary.Vocabulary,
) 
</code>
</pre></div></dt> <dd><p>Extend the model's vocabulary with <code>vocab</code></p> <h2 id="parameters">Parameters</h2> <dl><dt><strong><code>vocab</code></strong></dt> <dd>The model's vocabulary will be extended with this one.</dd></dl></dd> <pre class="title"><h3 id="init-prediction-logger"><a href="#init-prediction-logger" class="header-anchor">#</a> init_prediction_logger <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">init_prediction_logger</span> (
  self,
  output_dir: str,
  max_bytes: int = 20000000,
  backup_count: int = 20,
) 
</code>
</pre></div></dt> <dd><p>Initialize the prediction logger.</p> <p>If initialized we will log all predictions to a file called <em>predictions.json</em> in the <code>output_folder</code>.</p> <h2 id="parameters">Parameters</h2> <dl><dt><strong><code>output_dir</code></strong></dt> <dd>Path to the folder in which we create the <em>predictions.json</em> file.</dd> <dt><strong><code>max_bytes</code></strong></dt> <dd>Passed on to logging.handlers.RotatingFileHandler</dd> <dt><strong><code>backup_count</code></strong></dt> <dd>Passed on to logging.handlers.RotatingFileHandler</dd></dl></dd> <pre class="title"><h3 id="init-prediction-cache"><a href="#init-prediction-cache" class="header-anchor">#</a> init_prediction_cache <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">init_prediction_cache</span> (
  self,
  max_size: int,
)  -&gt; NoneType
</code>
</pre></div></dt> <dd><p>Initialize a prediction cache using the functools.lru_cache decorator</p> <h2 id="parameters">Parameters</h2> <dl><dt><strong><code>max_size</code></strong></dt> <dd>Save up to max_size most recent items.</dd></dl></dd> <pre class="title"><h3 id="predict"><a href="#predict" class="header-anchor">#</a> predict <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">predict</span> (
  self,
  batch: List[Dict[str, Union[str, List[str], Dict[str, str]]]],
  prediction_config: <a title="biome.text.configuration.PredictionConfiguration" href="configuration.html#biome.text.configuration.PredictionConfiguration">PredictionConfiguration</a>,
)  -&gt; List[Union[<a title="biome.text.modules.heads.task_prediction.TaskPrediction" href="modules/heads/task_prediction.html#biome.text.modules.heads.task_prediction.TaskPrediction">TaskPrediction</a>, NoneType]]
</code>
</pre></div></dt> <dd><p>Returns predictions given some input data based on the current state of the model</p> <p>The keys of the input dicts in the batch must coincide with the <code>self.inputs</code> attribute.
TODO: Comply with LightningModule API + Trainer API (means move instance creation logic to Pipeline)</p> <h2 id="parameters">Parameters</h2> <dl><dt><strong><code>batch</code></strong></dt> <dd>A list of dictionaries that represents a batch of inputs.
The dictionary keys must comply with the <code>self.inputs</code> attribute.</dd> <dt><strong><code>prediction_config</code></strong></dt> <dd>Contains configurations for the prediction</dd></dl></dd> <pre class="title"><h3 id="training-step"><a href="#training-step" class="header-anchor">#</a> training_step <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">training_step</span> (
  self,
  batch,
  batch_idx,
)  -&gt; Dict
</code>
</pre></div></dt> <dd><p>Here you compute and return the training loss and some additional metrics for e.g.
the progress bar or logger.</p> <p>Args:
batch (:class:<code>~torch.Tensor</code> | (:class:<code>~torch.Tensor</code>, …) | [:class:<code>~torch.Tensor</code>, …]):
The output of your :class:<code>~torch.utils.data.DataLoader</code>. A tensor, tuple or list.
batch_idx (int): Integer displaying index of this batch
optimizer_idx (int): When using multiple optimizers, this argument will also be present.
hiddens(:class:<code>~torch.Tensor</code>): Passed in if
:paramref:<code>~pytorch_lightning.trainer.trainer.Trainer.truncated_bptt_steps</code> &gt; 0.</p> <p>Return:
Any of.</p> <pre><code>- :class:`~torch.Tensor` - The loss tensor
- &lt;code&gt;dict&lt;/code&gt; - A dictionary. Can include any keys, but must include the key ``'loss'``
- &lt;code&gt;None&lt;/code&gt; - Training will skip to the next batch
</code></pre> <p>Note:
Returning <code>None</code> is currently not supported for multi-GPU or TPU, or with 16-bit precision enabled.</p> <p>In this step you'd normally do the forward pass and calculate the loss for a batch.
You can also do fancier things like multiple forward passes or something model specific.</p> <p>Example::</p> <pre><code>def training_step(self, batch, batch_idx):
    x, y, z = batch
    out = self.encoder(x)
    loss = self.loss(out, x)
    return loss
</code></pre> <p>If you define multiple optimizers, this step will be called with an additional
<code>optimizer_idx</code> parameter.</p> <p>.. code-block:: python</p> <pre><code># Multiple optimizers (e.g.: GANs)
def training_step(self, batch, batch_idx, optimizer_idx):
    if optimizer_idx == 0:
        # do training_step with encoder
    if optimizer_idx == 1:
        # do training_step with decoder
</code></pre> <p>If you add truncated back propagation through time you will also get an additional
argument with the hidden states of the previous step.</p> <p>.. code-block:: python</p> <pre><code># Truncated back-propagation through time
def training_step(self, batch, batch_idx, hiddens):
    # hiddens are the hidden states from the previous truncated backprop step
    ...
    out, hiddens = self.lstm(data, hiddens)
    ...
    return {'loss': loss, 'hiddens': hiddens}
</code></pre> <p>Note:
The loss value shown in the progress bar is smoothed (averaged) over the last values,
so it differs from the actual loss returned in train/validation step.</p></dd> <pre class="title"><h3 id="training-epoch-end"><a href="#training-epoch-end" class="header-anchor">#</a> training_epoch_end <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">training_epoch_end</span> (
  self,
  outputs: List[Any],
)  -&gt; NoneType
</code>
</pre></div></dt> <dd><p>Called at the end of the training epoch with the outputs of all training steps.
Use this in case you need to do something with all the outputs for every training_step.</p> <p>.. code-block:: python</p> <pre><code># the pseudocode for these calls
train_outs = []
for train_batch in train_data:
    out = training_step(train_batch)
    train_outs.append(out)
training_epoch_end(train_outs)
</code></pre> <p>Args:
outputs: List of outputs you defined in :meth:<code>training_step</code>, or if there are
multiple dataloaders, a list containing a list of outputs for each dataloader.</p> <p>Return:
None</p> <p>Note:
If this method is not overridden, this won't be called.</p> <p>Example::</p> <pre><code>def training_epoch_end(self, training_step_outputs):
    # do something with all training_step outputs
    return result
</code></pre> <p>With multiple dataloaders, <code>outputs</code> will be a list of lists. The outer list contains
one entry per dataloader, while the inner list contains the individual outputs of
each training step for that dataloader.</p> <p>.. code-block:: python</p> <pre><code>def training_epoch_end(self, training_step_outputs):
    for out in training_step_outputs:
        # do something here
</code></pre></dd> <pre class="title"><h3 id="validation-step"><a href="#validation-step" class="header-anchor">#</a> validation_step <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">validation_step</span> (
  self,
  batch,
  batch_idx,
)  -&gt; Dict
</code>
</pre></div></dt> <dd><p>Operates on a single batch of data from the validation set.
In this step you'd might generate examples or calculate anything of interest like accuracy.</p> <p>.. code-block:: python</p> <pre><code># the pseudocode for these calls
val_outs = []
for val_batch in val_data:
    out = validation_step(val_batch)
    val_outs.append(out)
validation_epoch_end(val_outs)
</code></pre> <p>Args:
batch (:class:<code>~torch.Tensor</code> | (:class:<code>~torch.Tensor</code>, …) | [:class:<code>~torch.Tensor</code>, …]):
The output of your :class:<code>~torch.utils.data.DataLoader</code>. A tensor, tuple or list.
batch_idx (int): The index of this batch
dataloader_idx (int): The index of the dataloader that produced this batch
(only if multiple val dataloaders used)</p> <p>Return:
Any of.</p> <pre><code>- Any object or value
- &lt;code&gt;None&lt;/code&gt; - Validation will skip to the next batch
</code></pre> <p>.. code-block:: python</p> <pre><code># pseudocode of order
out = validation_step()
if defined('validation_step_end'):
    out = validation_step_end(out)
out = validation_epoch_end(out)
</code></pre> <p>.. code-block:: python</p> <pre><code># if you have one val dataloader:
def validation_step(self, batch, batch_idx)
<h1 id="if-you-have-multiple-val-dataloaders"><a href="#if-you-have-multiple-val-dataloaders" class="header-anchor">#</a> if you have multiple val dataloaders:</h1>
<p>def validation_step(self, batch, batch_idx, dataloader_idx)
</p></code></pre> <p>Examples::</p> <pre><code># CASE 1: A single validation dataset
def validation_step(self, batch, batch_idx):
x, y = batch<p></p>
<div class="language- extra-class"><pre><code># implement your own
out = self(x)
loss = self.loss(out, y)

# log 6 example images
# or generated text... or whatever
sample_imgs = x[:6]
grid = torchvision.utils.make_grid(sample_imgs)
self.logger.experiment.add_image('example_images', grid, 0)

# calculate acc
labels_hat = torch.argmax(out, dim=1)
val_acc = torch.sum(y == labels_hat).item() / (len(y) * 1.0)

# log the outputs!
self.log_dict({'val_loss': loss, 'val_acc': val_acc})
</code></pre></div><p></p></code></pre> <p>If you pass in multiple val dataloaders, :meth:<code>validation_step</code> will have an additional argument.</p> <p>.. code-block:: python</p> <pre><code># CASE 2: multiple validation dataloaders
def validation_step(self, batch, batch_idx, dataloader_idx):
# dataloader_idx tells you which dataset this is.
</code></pre> <p>Note:
If you don't need to validate you don't need to implement this method.</p> <p>Note:
When the :meth:<code>validation_step</code> is called, the model has been put in eval mode
and PyTorch gradients have been disabled. At the end of validation,
the model goes back to training mode and gradients are enabled.</p></dd> <pre class="title"><p></p>
<h3 id="validation-epoch-end"><a href="#validation-epoch-end" class="header-anchor">#</a> validation_epoch_end <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">validation_epoch_end</span> (
  self,
  outputs: List[Any],
)  -&gt; NoneType
</code>
</pre></div></dt> <dd><p>Called at the end of the validation epoch with the outputs of all validation steps.</p> <p>.. code-block:: python</p> <pre><code># the pseudocode for these calls
val_outs = []
for val_batch in val_data:
    out = validation_step(val_batch)
    val_outs.append(out)
validation_epoch_end(val_outs)
</code></pre> <p>Args:
outputs: List of outputs you defined in :meth:<code>validation_step</code>, or if there
are multiple dataloaders, a list containing a list of outputs for each dataloader.</p> <p>Return:
None</p> <p>Note:
If you didn't define a :meth:<code>validation_step</code>, this won't be called.</p> <p>Examples:
With a single dataloader:</p> <pre><code>.. code-block:: python
<div class="language- extra-class"><pre><code>def validation_epoch_end(self, val_step_outputs):
    for out in val_step_outputs:
        # do something
</code></pre></div><p>With multiple dataloaders, &lt;code&gt;outputs&lt;/code&gt; will be a list of lists. The outer list contains
one entry per dataloader, while the inner list contains the individual outputs of
each validation step for that dataloader.</p> <p>.. code-block:: python</p> <div class="language- extra-class"><pre><code>def validation_epoch_end(self, outputs):
    for dataloader_output_result in outputs:
        dataloader_outs = dataloader_output_result.dataloader_i_outputs

    self.log('final_metric', final_value)
</code></pre></div><p></p></code></pre></dd> <pre class="title"><p></p>
<h3 id="configure-optimizers"><a href="#configure-optimizers" class="header-anchor">#</a> configure_optimizers <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Method</span></h3>
</pre> <dt><div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="ident">configure_optimizers</span>(<span>self)</span>
</code>
</pre></div></dt> <dd><p>Choose what optimizers and learning-rate schedulers to use in your optimization.
Normally you'd need one. But in the case of GANs or similar you might have multiple.</p> <p>Return:
Any of these 6 options.</p> <pre><code>- Single optimizer.
- List or Tuple - List of optimizers.
- Two lists - The first list has multiple optimizers, the second a list of LR schedulers (or lr_dict).
- Dictionary, with an 'optimizer' key, and (optionally) a 'lr_scheduler'
  key whose value is a single LR scheduler or lr_dict.
- Tuple of dictionaries as described, with an optional 'frequency' key.
- None - Fit will run without any optimizer.
</code></pre> <p>Note:
The 'frequency' value is an int corresponding to the number of sequential batches
optimized with the specific optimizer. It should be given to none or to all of the optimizers.
There is a difference between passing multiple optimizers in a list,
and passing multiple optimizers in dictionaries with a frequency of 1:
In the former case, all optimizers will operate on the given batch in each optimization step.
In the latter, only one optimizer will operate on the given batch at every step.</p> <pre><code>The lr_dict is a dictionary which contains the scheduler and its associated configuration.
The default configuration is shown below.
<p>.. code-block:: python</p>
<div class="language- extra-class"><pre><code>{
    'scheduler': lr_scheduler, # The LR scheduler instance (required)
    'interval': 'epoch', # The unit of the scheduler's step size
    'frequency': 1, # The frequency of the scheduler
    'reduce_on_plateau': False, # For ReduceLROnPlateau scheduler
    'monitor': 'val_loss', # Metric for ReduceLROnPlateau to monitor
    'strict': True, # Whether to crash the training if &amp;lt;code&amp;gt;monitor&amp;lt;/code&amp;gt; is not found
    'name': None, # Custom name for LearningRateMonitor to use
}
</code></pre></div><p>Only the &lt;code&gt;scheduler&lt;/code&gt; key is required, the rest will be set to the defaults above.
</p></code></pre> <p>Examples::</p> <pre><code># most cases
def configure_optimizers(self):
opt = Adam(self.parameters(), lr=1e-3)
return opt<p></p>
<h1 id="multiple-optimizer-case-e-g-gan"><a href="#multiple-optimizer-case-e-g-gan" class="header-anchor">#</a> multiple optimizer case (e.g.: GAN)</h1>
<p>def configure_optimizers(self):
generator_opt = Adam(self.model_gen.parameters(), lr=0.01)
disriminator_opt = Adam(self.model_disc.parameters(), lr=0.02)
return generator_opt, disriminator_opt</p>
<h1 id="example-with-learning-rate-schedulers"><a href="#example-with-learning-rate-schedulers" class="header-anchor">#</a> example with learning rate schedulers</h1>
<p>def configure_optimizers(self):
generator_opt = Adam(self.model_gen.parameters(), lr=0.01)
disriminator_opt = Adam(self.model_disc.parameters(), lr=0.02)
discriminator_sched = CosineAnnealing(discriminator_opt, T_max=10)
return [generator_opt, disriminator_opt], [discriminator_sched]</p>
<h1 id="example-with-step-based-learning-rate-schedulers"><a href="#example-with-step-based-learning-rate-schedulers" class="header-anchor">#</a> example with step-based learning rate schedulers</h1>
<p>def configure_optimizers(self):
gen_opt = Adam(self.model_gen.parameters(), lr=0.01)
dis_opt = Adam(self.model_disc.parameters(), lr=0.02)
gen_sched = {'scheduler': ExponentialLR(gen_opt, 0.99),
'interval': 'step'}  # called after each training step
dis_sched = CosineAnnealing(discriminator_opt, T_max=10) # called every epoch
return [gen_opt, dis_opt], [gen_sched, dis_sched]</p>
<h1 id="example-with-optimizer-frequencies"><a href="#example-with-optimizer-frequencies" class="header-anchor">#</a> example with optimizer frequencies</h1>
<h1 id="see-training-procedure-in-code-improved-training-of-wasserstein-gans-code-algorithm-1"><a href="#see-training-procedure-in-code-improved-training-of-wasserstein-gans-code-algorithm-1" class="header-anchor">#</a> see training procedure in &lt;code&gt;Improved Training of Wasserstein GANs&lt;/code&gt;, Algorithm 1</h1>
<h1 id="https-arxiv-org-abs-1704-00028"><a href="#https-arxiv-org-abs-1704-00028" class="header-anchor">#</a> &lt;https://arxiv.org/abs/1704.00028&gt;</h1>
<p>def configure_optimizers(self):
gen_opt = Adam(self.model_gen.parameters(), lr=0.01)
dis_opt = Adam(self.model_disc.parameters(), lr=0.02)
n_critic = 5
return (
{'optimizer': dis_opt, 'frequency': n_critic},
{'optimizer': gen_opt, 'frequency': 1}
)
</p></code></pre> <p>Note:</p> <pre><code>Some things to know:<p></p>
<ul>
<li>
<p>Lightning calls &lt;code&gt;.backward()&lt;/code&gt; and &lt;code&gt;.step()&lt;/code&gt; on each optimizer
and learning rate scheduler as needed.</p>
</li>
<li>
<p>If you use 16-bit precision (<code>precision=16</code>), Lightning will automatically
handle the optimizers for you.</p>
</li>
<li>
<p>If you use multiple optimizers, :meth:&lt;code&gt;training_step&lt;/code&gt; will have an additional
&lt;code&gt;optimizer_idx&lt;/code&gt; parameter.</p>
</li>
<li>
<p>If you use LBFGS Lightning handles the closure function automatically for you.</p>
</li>
<li>
<p>If you use multiple optimizers, gradients will be calculated only
for the parameters of current optimizer at each training step.</p>
</li>
<li>
<p>If you need to control how often those optimizers step or override the
default &lt;code&gt;.step()&lt;/code&gt; schedule, override the :meth:&lt;code&gt;optimizer_step&lt;/code&gt; hook.</p>
</li>
<li>
<p>If you only want to call a learning rate scheduler every &lt;code&gt;x&lt;/code&gt; step or epoch,
or want to monitor a custom metric, you can specify these in a lr_dict:</p>
<p>.. code-block:: python</p>
<div class="language- extra-class"><pre><code>{
    'scheduler': lr_scheduler,
    'interval': 'step',  # or 'epoch'
    'monitor': 'val_f1',
    'frequency': x,
}
</code></pre></div></li></ul> <p></p></code></pre></dd></dl><p></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="page-nav__button prev"><a href="/biome-text/master/api/biome/text/mlflow_model.html" class="prev"><span class="page-nav__button__icon"><vp-icon color="#4A4A4A" name="chev-left" size="18px"></vp-icon></span> <span class="page-nav__button__text">
          biome.text.mlflow_model
        </span></a></span> <span class="page-nav__button next"><a href="/biome-text/master/api/biome/text/modules/configuration/allennlp_configuration.html"><span class="page-nav__button__text">
          biome.text.modules.configuration.allennlp_configuration
        </span> <span class="page-nav__button__icon"><vp-icon color="#4A4A4A" name="chev-right" size="18px"></vp-icon></span></a></span></p></div> <footer class="footer" data-v-348088ed><div data-v-348088ed>
          Maintained by
          <a href="https://www.recogn.ai/" target="_blank" data-v-348088ed><img width="70px" src="/biome-text/master/assets/img/recognai.png" class="footer__img" data-v-348088ed></a></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/biome-text/master/assets/js/app.7e5ef899.js" defer></script><script src="/biome-text/master/assets/js/4.8c7282f9.js" defer></script><script src="/biome-text/master/assets/js/3.c1cfb773.js" defer></script><script src="/biome-text/master/assets/js/34.3abafb22.js" defer></script><script src="/biome-text/master/assets/js/6.4b76f008.js" defer></script>
  </body>
</html>
