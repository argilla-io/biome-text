language: python

services:
  - elasticsearch

python:
  - "3.7"

before_install:
  - sudo apt-get update
  - sudo apt-get install nodejs -q -y

install:
  - pip install -U pip
  - pip install -U six

script:
  - make dev dist docs

before_deploy:
  - pip install twine

deploy:
  - provider: pages
    skip_cleanup: true
    local_dir: documentation/site
    github_token: $GITHUB_TOKEN
    keep_history: true
    on:
      condition: $TRAVIS_BRANCH == "master" || -n $TRAVIS_TAG

  - skip_cleanup: true
    provider: script
    script:
    - twine upload dist/*
    on:
      branch: master

  - skip_cleanup: true
    provider: script
    script: twine upload --repository-url https://test.pypi.org/legacy/ dist/*
    on:
      branch: releases/#157

  - skip_cleanup: true
    provider: script
    script: twine upload dist/*
    on:
      tags: true
